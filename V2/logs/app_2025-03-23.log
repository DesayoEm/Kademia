2025-03-23 06:18:43,187 - kademia - INFO - Application started
2025-03-23 06:18:45,698 - kademia - INFO - Request started | eb1de386-3f86-4b2d-922d-a28fd46d02f9 | GET /
2025-03-23 06:18:45,708 - kademia - INFO - Request completed | eb1de386-3f86-4b2d-922d-a28fd46d02f9 | Status: 200 | Time: 0.007s
2025-03-23 06:18:45,928 - kademia - INFO - Request started | e0ba581f-040c-4d45-bd47-b9009deef675 | GET /favicon.ico
2025-03-23 06:18:45,929 - kademia - INFO - Request completed | e0ba581f-040c-4d45-bd47-b9009deef675 | Status: 404 | Time: 0.001s
2025-03-23 06:18:51,419 - kademia - INFO - Request started | b7d68e30-d8ff-412f-8561-f88bb9d941e7 | GET /docs
2025-03-23 06:18:51,420 - kademia - INFO - Request completed | b7d68e30-d8ff-412f-8561-f88bb9d941e7 | Status: 200 | Time: 0.001s
2025-03-23 06:18:51,534 - kademia - INFO - Request started | 2bb34b4e-0ac0-47ac-b852-3a55a8d3824a | GET /openapi.json
2025-03-23 06:18:51,640 - kademia - INFO - Request completed | 2bb34b4e-0ac0-47ac-b852-3a55a8d3824a | Status: 200 | Time: 0.107s
2025-03-23 06:19:14,861 - kademia - INFO - Request started | ae1da959-4715-430b-931f-1c80d19d9b27 | POST /api/v1/admin/students/
2025-03-23 06:19:15,180 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 06:19:15,180 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:19:15,182 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 06:19:15,182 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:19:15,183 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 06:19:15,183 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:19:15,184 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 06:19:15,327 - sqlalchemy.engine.Engine - INFO - SELECT max(CAST(SUBSTRING(students.student_id FROM %(substring_1)s) AS INTEGER)) AS max_1 
FROM students 
WHERE students.student_id LIKE %(student_id_1)s AND students.session_start_year = %(session_start_year_1)s
2025-03-23 06:19:15,328 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] {'substring_1': 8, 'student_id_1': 'SCH-25-%', 'session_start_year_1': 2025}
2025-03-23 06:19:15,339 - sqlalchemy.engine.Engine - INFO - INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at
2025-03-23 06:19:15,340 - sqlalchemy.engine.Engine - INFO - [generated in 0.00085s] {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('65fefefb-ea56-4c2e-b343-9515d8fb470e'), 'password_hash': '$2b$12$LAXt4LoUe2LXjM8gjZNIhOtxNcKb0wbpZnQiAnVPKU2xotYg6eLv6', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 06:19:15,345 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 06:19:15,347 - kademia - ERROR - Unhandled exception | ae1da959-4715-430b-931f-1c80d19d9b27 | Foreign key constraint violation during create operation. Detail: Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('65fefefb-ea56-4c2e-b343-9515d8fb470e'), 'password_hash': '$2b$12$LAXt4LoUe2LXjM8gjZNIhOtxNcKb0wbpZnQiAnVPKU2xotYg6eLv6', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 98, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\users\student\student.py", line 18, in create_student
    return student_crud.create_student(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\users\student.py", line 30, in create_student
    student = self.factory.create_student(data)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\users\student.py", line 92, in create_student
    raise RelationshipError(error=str(e), operation='create', entity='unknown_entity')
app.core.errors.database_errors.RelationshipError: Foreign key constraint violation during create operation. Detail: Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('65fefefb-ea56-4c2e-b343-9515d8fb470e'), 'password_hash': '$2b$12$LAXt4LoUe2LXjM8gjZNIhOtxNcKb0wbpZnQiAnVPKU2xotYg6eLv6', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 06:19:15,360 - kademia - WARNING - RelationshipError | ae1da959-4715-430b-931f-1c80d19d9b27 | Foreign key constraint violation during create operation. Detail: Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('65fefefb-ea56-4c2e-b343-9515d8fb470e'), 'password_hash': '$2b$12$LAXt4LoUe2LXjM8gjZNIhOtxNcKb0wbpZnQiAnVPKU2xotYg6eLv6', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 06:20:50,617 - kademia - INFO - Application started
2025-03-23 06:25:14,191 - kademia - INFO - Application started
2025-03-23 06:25:16,351 - kademia - INFO - Request started | 1ed27a93-6e9e-4b1f-9c95-be31f36274c7 | GET /docs
2025-03-23 06:25:16,352 - kademia - INFO - Request completed | 1ed27a93-6e9e-4b1f-9c95-be31f36274c7 | Status: 200 | Time: 0.000s
2025-03-23 06:25:16,454 - kademia - INFO - Request started | 8deb7866-421c-4d5d-b3bd-07d025f75343 | GET /openapi.json
2025-03-23 06:25:16,543 - kademia - INFO - Request completed | 8deb7866-421c-4d5d-b3bd-07d025f75343 | Status: 200 | Time: 0.089s
2025-03-23 06:25:26,715 - kademia - INFO - Request started | eb1a05fa-2157-4373-b59f-943a3de9a8d9 | POST /api/v1/admin/students/
2025-03-23 06:25:27,185 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 06:25:27,186 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:25:27,187 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 06:25:27,188 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:25:27,189 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 06:25:27,189 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:25:27,191 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 06:25:27,348 - sqlalchemy.engine.Engine - INFO - SELECT max(CAST(SUBSTRING(students.student_id FROM %(substring_1)s) AS INTEGER)) AS max_1 
FROM students 
WHERE students.student_id LIKE %(student_id_1)s AND students.session_start_year = %(session_start_year_1)s
2025-03-23 06:25:27,349 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] {'substring_1': 8, 'student_id_1': 'SCH-25-%', 'session_start_year_1': 2025}
2025-03-23 06:25:27,358 - sqlalchemy.engine.Engine - INFO - INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at
2025-03-23 06:25:27,359 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('46e655eb-4aaa-4941-ae12-0a6772be0482'), 'password_hash': '$2b$12$GRt.G24kntPszksAfDx2AerB.Cw6QR7N8.OxNPjcPNi69krqC3cYC', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 06:25:27,365 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 06:25:27,366 - kademia - ERROR - Unhandled exception | eb1a05fa-2157-4373-b59f-943a3de9a8d9 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('46e655eb-4aaa-4941-ae12-0a6772be0482'), 'password_hash': '$2b$12$GRt.G24kntPszksAfDx2AerB.Cw6QR7N8.OxNPjcPNi69krqC3cYC', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 98, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\users\student\student.py", line 18, in create_student
    return student_crud.create_student(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\users\student.py", line 30, in create_student
    student = self.factory.create_student(data)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\users\student.py", line 82, in create_student
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.student_organisation_errors.RelatedLevelNotFoundError: Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('46e655eb-4aaa-4941-ae12-0a6772be0482'), 'password_hash': '$2b$12$GRt.G24kntPszksAfDx2AerB.Cw6QR7N8.OxNPjcPNi69krqC3cYC', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 06:25:27,375 - kademia - WARNING - RelationshipError | eb1a05fa-2157-4373-b59f-943a3de9a8d9 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('46e655eb-4aaa-4941-ae12-0a6772be0482'), 'password_hash': '$2b$12$GRt.G24kntPszksAfDx2AerB.Cw6QR7N8.OxNPjcPNi69krqC3cYC', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 06:26:13,095 - kademia - INFO - Application started
2025-03-23 06:26:14,824 - kademia - INFO - Request started | 54ced96a-5b58-4156-a8f8-e206471921cc | GET /docs
2025-03-23 06:26:14,826 - kademia - INFO - Request completed | 54ced96a-5b58-4156-a8f8-e206471921cc | Status: 200 | Time: 0.002s
2025-03-23 06:26:14,939 - kademia - INFO - Request started | 4555b107-8a8d-4e95-b594-8af4c9eca489 | GET /openapi.json
2025-03-23 06:26:15,027 - kademia - INFO - Request completed | 4555b107-8a8d-4e95-b594-8af4c9eca489 | Status: 200 | Time: 0.087s
2025-03-23 06:26:27,442 - kademia - INFO - Request started | 3df151d7-e140-4e79-914e-32537217ffa9 | POST /api/v1/admin/students/
2025-03-23 06:26:27,766 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 06:26:27,767 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:26:27,768 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 06:26:27,768 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:26:27,769 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 06:26:27,770 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 06:26:27,771 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 06:26:27,934 - sqlalchemy.engine.Engine - INFO - SELECT max(CAST(SUBSTRING(students.student_id FROM %(substring_1)s) AS INTEGER)) AS max_1 
FROM students 
WHERE students.student_id LIKE %(student_id_1)s AND students.session_start_year = %(session_start_year_1)s
2025-03-23 06:26:27,935 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] {'substring_1': 8, 'student_id_1': 'SCH-25-%', 'session_start_year_1': 2025}
2025-03-23 06:26:27,944 - sqlalchemy.engine.Engine - INFO - INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at
2025-03-23 06:26:27,945 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('d3f020c5-8d57-4018-a489-f2ba0ed204e0'), 'password_hash': '$2b$12$7qXILEf3yYKtM.zMx.8ATOhlyZlssLM41e7/SftK20ok0g2FA088C', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 06:26:27,951 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 06:26:27,952 - kademia - ERROR - Unhandled exception | 3df151d7-e140-4e79-914e-32537217ffa9 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('d3f020c5-8d57-4018-a489-f2ba0ed204e0'), 'password_hash': '$2b$12$7qXILEf3yYKtM.zMx.8ATOhlyZlssLM41e7/SftK20ok0g2FA088C', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 98, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\users\student\student.py", line 18, in create_student
    return student_crud.create_student(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\users\student.py", line 30, in create_student
    student = self.factory.create_student(data)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\users\student.py", line 82, in create_student
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.student_organisation_errors.RelatedLevelNotFoundError: Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('d3f020c5-8d57-4018-a489-f2ba0ed204e0'), 'password_hash': '$2b$12$7qXILEf3yYKtM.zMx.8ATOhlyZlssLM41e7/SftK20ok0g2FA088C', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 06:26:27,963 - kademia - WARNING - RelationshipError | 3df151d7-e140-4e79-914e-32537217ffa9 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('00000000-0000-0000-0000-000000000001'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('d3f020c5-8d57-4018-a489-f2ba0ed204e0'), 'password_hash': '$2b$12$7qXILEf3yYKtM.zMx.8ATOhlyZlssLM41e7/SftK20ok0g2FA088C', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 06:26:56,006 - kademia - INFO - Application started
2025-03-23 06:53:43,254 - kademia - INFO - Application started
2025-03-23 08:01:12,967 - kademia - INFO - Application started
2025-03-23 08:01:22,882 - kademia - INFO - Request started | f26c959e-4b89-473f-a4bf-bbec0d2053b5 | GET /
2025-03-23 08:01:22,886 - kademia - INFO - Request completed | f26c959e-4b89-473f-a4bf-bbec0d2053b5 | Status: 200 | Time: 0.002s
2025-03-23 08:01:23,114 - kademia - INFO - Request started | 6d00b78a-757c-412c-b9d9-59af72188a7c | GET /favicon.ico
2025-03-23 08:01:23,118 - kademia - INFO - Request completed | 6d00b78a-757c-412c-b9d9-59af72188a7c | Status: 404 | Time: 0.002s
2025-03-23 08:01:26,254 - kademia - INFO - Request started | 862953f6-e38b-4d7e-bd24-60b7ed0cb91b | GET /docs
2025-03-23 08:01:26,256 - kademia - INFO - Request completed | 862953f6-e38b-4d7e-bd24-60b7ed0cb91b | Status: 200 | Time: 0.000s
2025-03-23 08:01:26,614 - kademia - INFO - Request started | 76c435fc-a105-42a9-bd0f-0526afbfbea5 | GET /openapi.json
2025-03-23 08:01:26,718 - kademia - INFO - Request completed | 76c435fc-a105-42a9-bd0f-0526afbfbea5 | Status: 200 | Time: 0.104s
2025-03-23 08:01:48,102 - kademia - INFO - Request started | 8bcb52bb-948a-4602-9d0a-7f64300c2ff7 | POST /api/v1/admin/guardians/
2025-03-23 08:01:48,971 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 08:01:48,972 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:01:48,977 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 08:01:48,978 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:01:48,980 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 08:01:48,980 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:01:48,982 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:01:48,987 - sqlalchemy.engine.Engine - INFO - INSERT INTO guardians (access_level, user_type, image_url, email_address, address, phone, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(access_level)s, %(user_type)s, %(image_url)s, %(email_address)s, %(address)s, %(phone)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING guardians.created_at, guardians.last_modified_at
2025-03-23 08:01:48,987 - sqlalchemy.engine.Engine - INFO - [generated in 0.00124s] {'access_level': 'READ', 'user_type': 'GUARDIAN', 'image_url': None, 'email_address': 'bola.coker@example.com', 'address': '123 Akala Express Ibadan', 'phone': '+2348056794345', 'id': UUID('fc8d0d29-6f14-4d88-9d86-8c197c15492f'), 'password_hash': '$2b$12$TX68N681NTCIoJ/zRHz1JOw1q.uxJWHrMM4qBIh1DFmuD9NAByAoi', 'first_name': 'Bola', 'last_name': 'Coker', 'gender': 'MALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:01:49,007 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:01:49,009 - kademia - ERROR - Unhandled exception | 8bcb52bb-948a-4602-9d0a-7f64300c2ff7 | Unique constraint violated for during guardian creation with bola.coker@example.com. Detail unique constraint violation - detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "guardians_email_address_key"
detail:  key (email_address)=(bola.coker@example.com) already exists.

[sql: insert into guardians (access_level, user_type, image_url, email_address, address, phone, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(access_level)s, %(user_type)s, %(image_url)s, %(email_address)s, %(address)s, %(phone)s, %(id)s::uuid, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning guardians.created_at, guardians.last_modified_at]
[parameters: {'access_level': 'read', 'user_type': 'guardian', 'image_url': none, 'email_address': 'bola.coker@example.com', 'address': '123 akala express ibadan', 'phone': '+2348056794345', 'id': uuid('fc8d0d29-6f14-4d88-9d86-8c197c15492f'), 'password_hash': '$2b$12$tx68n681ntcioj/zrhz1jow1q.uxjwhrmm4qbih1dfmud9nabyaoi', 'first_name': 'bola', 'last_name': 'coker', 'gender': 'male', 'last_login': none, 'deletion_eligible': false, 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\users\guardian\guardian.py", line 18, in create_guardian
    return guardian_crud.create_guardian(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\users\guardian.py", line 30, in create_guardian
    guardian = self.factory.create_guardian(data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\users\guardian.py", line 53, in create_guardian
    raise DuplicateGuardianError(
app.core.errors.user_profile_errors.DuplicateGuardianError: Unique constraint violated for during guardian creation with bola.coker@example.com. Detail unique constraint violation - detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "guardians_email_address_key"
detail:  key (email_address)=(bola.coker@example.com) already exists.

[sql: insert into guardians (access_level, user_type, image_url, email_address, address, phone, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(access_level)s, %(user_type)s, %(image_url)s, %(email_address)s, %(address)s, %(phone)s, %(id)s::uuid, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning guardians.created_at, guardians.last_modified_at]
[parameters: {'access_level': 'read', 'user_type': 'guardian', 'image_url': none, 'email_address': 'bola.coker@example.com', 'address': '123 akala express ibadan', 'phone': '+2348056794345', 'id': uuid('fc8d0d29-6f14-4d88-9d86-8c197c15492f'), 'password_hash': '$2b$12$tx68n681ntcioj/zrhz1jow1q.uxjwhrmm4qbih1dfmud9nabyaoi', 'first_name': 'bola', 'last_name': 'coker', 'gender': 'male', 'last_login': none, 'deletion_eligible': false, 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:01:49,033 - kademia - WARNING - UniqueViolationError | 8bcb52bb-948a-4602-9d0a-7f64300c2ff7 | Unique constraint violated for during guardian creation with bola.coker@example.com. Detail unique constraint violation - detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "guardians_email_address_key"
detail:  key (email_address)=(bola.coker@example.com) already exists.

[sql: insert into guardians (access_level, user_type, image_url, email_address, address, phone, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(access_level)s, %(user_type)s, %(image_url)s, %(email_address)s, %(address)s, %(phone)s, %(id)s::uuid, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning guardians.created_at, guardians.last_modified_at]
[parameters: {'access_level': 'read', 'user_type': 'guardian', 'image_url': none, 'email_address': 'bola.coker@example.com', 'address': '123 akala express ibadan', 'phone': '+2348056794345', 'id': uuid('fc8d0d29-6f14-4d88-9d86-8c197c15492f'), 'password_hash': '$2b$12$tx68n681ntcioj/zrhz1jow1q.uxjwhrmm4qbih1dfmud9nabyaoi', 'first_name': 'bola', 'last_name': 'coker', 'gender': 'male', 'last_login': none, 'deletion_eligible': false, 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:02:21,384 - kademia - INFO - Request started | b93d1bcf-f742-4c7e-8e28-9e898256ef1b | POST /api/v1/admin/students/departments/
2025-03-23 08:02:21,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:02:21,393 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:02:21,393 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] {'id': UUID('96460ac2-680b-4913-a566-579d19b7dbe2'), 'name': 'Science', 'code': 'SCI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': None, 'assistant_rep_id': None, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:02:21,434 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:02:21,437 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:02:21,444 - sqlalchemy.engine.Engine - INFO - SELECT student_departments.id, student_departments.name, student_departments.code, student_departments.description, student_departments.mentor_id, student_departments.student_rep_id, student_departments.assistant_rep_id, student_departments.created_by, student_departments.last_modified_by, student_departments.created_at, student_departments.last_modified_at, student_departments.is_archived, student_departments.archived_at, student_departments.archive_reason, student_departments.archived_by 
FROM student_departments 
WHERE student_departments.id = %(pk_1)s::UUID
2025-03-23 08:02:21,445 - sqlalchemy.engine.Engine - INFO - [generated in 0.00105s] {'pk_1': UUID('96460ac2-680b-4913-a566-579d19b7dbe2')}
2025-03-23 08:02:21,449 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:02:21,450 - kademia - INFO - Request completed | b93d1bcf-f742-4c7e-8e28-9e898256ef1b | Status: 201 | Time: 0.065s
2025-03-23 08:02:33,470 - kademia - INFO - Request started | 6b7a0469-2e05-4804-8fff-e296b20f70bd | POST /api/v1/admin/students/academic_levels/
2025-03-23 08:02:33,475 - kademia - ERROR - Unhandled exception | 6b7a0469-2e05-4804-8fff-e296b20f70bd | 
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\academic_levels.py", line 21, in create_level
    return academic_level_crud.create_level(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\academic_levels.py", line 30, in create_level
    level = self.factory.create_academic_level(data)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\academic_level.py", line 33, in create_academic_level
    name = self.validator.validate_name(new_academic_level.name),
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\validators\student_organization.py", line 18, in validate_name
    raise InvalidCharacterError(entry=value, domain=self.domain)
app.core.errors.input_validation_errors.InvalidCharacterError
2025-03-23 08:02:33,488 - kademia - WARNING - InvalidCharacterError | 6b7a0469-2e05-4804-8fff-e296b20f70bd | Domain: STUDENT ORGANIZATION-- Input attempted with invalid character: JSS1
2025-03-23 08:04:25,824 - kademia - INFO - Request started | 78ca68d9-e716-4ef3-818c-d50c2bad4298 | POST /api/v1/admin/students/academic_levels/
2025-03-23 08:04:25,827 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:04:25,830 - sqlalchemy.engine.Engine - INFO - INSERT INTO academic_levels (id, name, description, "order", created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(description)s, %(order)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING academic_levels.created_at, academic_levels.last_modified_at
2025-03-23 08:04:25,830 - sqlalchemy.engine.Engine - INFO - [generated in 0.00130s] {'id': UUID('8c140d45-6b60-4b12-8a89-b0ab84db8c07'), 'name': 'Jss', 'description': 'First Level In The Secondary School System', 'order': 1, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:04:25,846 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:04:25,850 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:04:25,856 - sqlalchemy.engine.Engine - INFO - SELECT academic_levels.id, academic_levels.name, academic_levels.description, academic_levels."order", academic_levels.created_by, academic_levels.last_modified_by, academic_levels.created_at, academic_levels.last_modified_at, academic_levels.is_archived, academic_levels.archived_at, academic_levels.archive_reason, academic_levels.archived_by 
FROM academic_levels 
WHERE academic_levels.id = %(pk_1)s::UUID
2025-03-23 08:04:25,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] {'pk_1': UUID('8c140d45-6b60-4b12-8a89-b0ab84db8c07')}
2025-03-23 08:04:25,861 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:04:25,862 - kademia - INFO - Request completed | 78ca68d9-e716-4ef3-818c-d50c2bad4298 | Status: 201 | Time: 0.038s
2025-03-23 08:07:24,503 - kademia - INFO - Application started
2025-03-23 08:07:31,968 - kademia - INFO - Request started | 57560fd3-d4a4-486f-bf35-90fa6d3c668a | GET /docs
2025-03-23 08:07:31,971 - kademia - INFO - Request completed | 57560fd3-d4a4-486f-bf35-90fa6d3c668a | Status: 200 | Time: 0.002s
2025-03-23 08:07:32,277 - kademia - INFO - Request started | 86ea0d99-454f-4a22-beb4-d1b2a0d5f398 | GET /openapi.json
2025-03-23 08:07:32,447 - kademia - INFO - Request completed | 86ea0d99-454f-4a22-beb4-d1b2a0d5f398 | Status: 200 | Time: 0.170s
2025-03-23 08:07:56,975 - kademia - INFO - Request started | a8950021-e9fa-42aa-86d3-c25e2cd74c6f | POST /api/v1/admin/guardians/
2025-03-23 08:07:57,679 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 08:07:57,680 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:07:57,683 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 08:07:57,683 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:07:57,684 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 08:07:57,685 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:07:57,688 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:07:57,692 - sqlalchemy.engine.Engine - INFO - INSERT INTO guardians (access_level, user_type, image_url, email_address, address, phone, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(access_level)s, %(user_type)s, %(image_url)s, %(email_address)s, %(address)s, %(phone)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING guardians.created_at, guardians.last_modified_at
2025-03-23 08:07:57,693 - sqlalchemy.engine.Engine - INFO - [generated in 0.00123s] {'access_level': 'READ', 'user_type': 'GUARDIAN', 'image_url': None, 'email_address': 'bola.coker@example.com', 'address': '123 Akala Express Ibadan', 'phone': '+2348056794345', 'id': UUID('c6395ac5-00a3-49e4-8099-9623c02a84a7'), 'password_hash': '$2b$12$poWrukQx8OYYMiRp2oPxSunIjPvfBqYCxdzE5q1qLiCXfZ73Oo2dO', 'first_name': 'Bola', 'last_name': 'Coker', 'gender': 'MALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:07:57,713 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:07:57,717 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:07:57,726 - sqlalchemy.engine.Engine - INFO - SELECT guardians.access_level, guardians.user_type, guardians.image_url, guardians.email_address, guardians.address, guardians.phone, guardians.id, guardians.password_hash, guardians.first_name, guardians.last_name, guardians.gender, guardians.last_login, guardians.deletion_eligible, guardians.created_by, guardians.last_modified_by, guardians.created_at, guardians.last_modified_at, guardians.is_archived, guardians.archived_at, guardians.archive_reason, guardians.archived_by 
FROM guardians 
WHERE guardians.id = %(pk_1)s::UUID
2025-03-23 08:07:57,727 - sqlalchemy.engine.Engine - INFO - [generated in 0.00138s] {'pk_1': UUID('c6395ac5-00a3-49e4-8099-9623c02a84a7')}
2025-03-23 08:07:57,731 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:07:57,734 - kademia - INFO - Request completed | a8950021-e9fa-42aa-86d3-c25e2cd74c6f | Status: 201 | Time: 0.758s
2025-03-23 08:09:02,840 - kademia - INFO - Request started | 5488acc2-4a16-4d75-b7a3-04c9674dcb93 | POST /api/v1/admin/students/departments/
2025-03-23 08:09:02,845 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:09:02,848 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:09:02,848 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] {'id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'name': 'Science', 'code': 'SCI', 'description': 'SCIENCE CLASSES', 'mentor_id': None, 'student_rep_id': None, 'assistant_rep_id': None, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:09:02,859 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:09:02,865 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:09:02,867 - sqlalchemy.engine.Engine - INFO - SELECT student_departments.id, student_departments.name, student_departments.code, student_departments.description, student_departments.mentor_id, student_departments.student_rep_id, student_departments.assistant_rep_id, student_departments.created_by, student_departments.last_modified_by, student_departments.created_at, student_departments.last_modified_at, student_departments.is_archived, student_departments.archived_at, student_departments.archive_reason, student_departments.archived_by 
FROM student_departments 
WHERE student_departments.id = %(pk_1)s::UUID
2025-03-23 08:09:02,869 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] {'pk_1': UUID('eed42413-ea88-47a7-b6fa-06c128e29640')}
2025-03-23 08:09:02,871 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:09:02,872 - kademia - INFO - Request completed | 5488acc2-4a16-4d75-b7a3-04c9674dcb93 | Status: 201 | Time: 0.032s
2025-03-23 08:09:47,686 - kademia - INFO - Request started | 17d076a3-ae57-41fa-bcb9-a60f29dd166f | POST /api/v1/admin/students/academic_levels/
2025-03-23 08:09:47,689 - kademia - ERROR - Unhandled exception | 17d076a3-ae57-41fa-bcb9-a60f29dd166f | 
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\academic_levels.py", line 21, in create_level
    return academic_level_crud.create_level(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\academic_levels.py", line 30, in create_level
    level = self.factory.create_academic_level(data)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\academic_level.py", line 33, in create_academic_level
    name = self.validator.validate_name(new_academic_level.name),
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\validators\student_organization.py", line 18, in validate_name
    raise InvalidCharacterError(entry=value, domain=self.domain)
app.core.errors.input_validation_errors.InvalidCharacterError
2025-03-23 08:09:47,718 - kademia - WARNING - InvalidCharacterError | 17d076a3-ae57-41fa-bcb9-a60f29dd166f | Domain: STUDENT ORGANIZATION-- Input attempted with invalid character: JSS1
2025-03-23 08:10:17,115 - kademia - INFO - Application started
2025-03-23 08:11:04,862 - kademia - INFO - Application started
2025-03-23 08:11:08,862 - kademia - INFO - Request started | 8c2e7b86-1f9e-4f23-b0a6-99c73e403070 | GET /docs
2025-03-23 08:11:08,863 - kademia - INFO - Request completed | 8c2e7b86-1f9e-4f23-b0a6-99c73e403070 | Status: 200 | Time: 0.001s
2025-03-23 08:11:08,997 - kademia - INFO - Request started | 79dd3c06-ef85-4134-9e14-89d2ef6f750d | GET /openapi.json
2025-03-23 08:11:09,129 - kademia - INFO - Request completed | 79dd3c06-ef85-4134-9e14-89d2ef6f750d | Status: 200 | Time: 0.132s
2025-03-23 08:11:29,703 - kademia - INFO - Request started | ca0cb594-e301-40a6-bd63-41b43ebbbb4a | POST /api/v1/admin/students/academic_levels/
2025-03-23 08:11:30,164 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 08:11:30,164 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:11:30,166 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 08:11:30,167 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:11:30,168 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 08:11:30,168 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:11:30,170 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:11:30,173 - sqlalchemy.engine.Engine - INFO - INSERT INTO academic_levels (id, name, description, "order", created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(description)s, %(order)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING academic_levels.created_at, academic_levels.last_modified_at
2025-03-23 08:11:30,174 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] {'id': UUID('56b3bf97-4235-4c4c-949d-8ea8d83a2010'), 'name': 'JSS1', 'description': 'First Level In The Secondary School System', 'order': 1, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:11:30,188 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:11:30,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:11:30,196 - sqlalchemy.engine.Engine - INFO - SELECT academic_levels.id, academic_levels.name, academic_levels.description, academic_levels."order", academic_levels.created_by, academic_levels.last_modified_by, academic_levels.created_at, academic_levels.last_modified_at, academic_levels.is_archived, academic_levels.archived_at, academic_levels.archive_reason, academic_levels.archived_by 
FROM academic_levels 
WHERE academic_levels.id = %(pk_1)s::UUID
2025-03-23 08:11:30,197 - sqlalchemy.engine.Engine - INFO - [generated in 0.00080s] {'pk_1': UUID('56b3bf97-4235-4c4c-949d-8ea8d83a2010')}
2025-03-23 08:11:30,201 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:11:30,203 - kademia - INFO - Request completed | ca0cb594-e301-40a6-bd63-41b43ebbbb4a | Status: 201 | Time: 0.499s
2025-03-23 08:12:17,121 - kademia - INFO - Request started | 739ad5a6-ec3b-4647-9a20-cfd4c3498c87 | POST /api/v1/admin/students/student_organization/
2025-03-23 08:12:17,128 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:12:17,132 - sqlalchemy.engine.Engine - INFO - SELECT max(classes."order") AS max_1 
FROM classes 
WHERE classes.level_id = %(level_id_1)s::UUID
2025-03-23 08:12:17,132 - sqlalchemy.engine.Engine - INFO - [generated in 0.00078s] {'level_id_1': UUID('00000000-0000-0000-0000-000000000000')}
2025-03-23 08:12:17,143 - sqlalchemy.engine.Engine - INFO - INSERT INTO classes (id, level_id, code, supervisor_id, student_rep_id, assistant_rep_id, "order", created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(level_id)s::UUID, %(code)s, %(supervisor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(order)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING classes.created_at, classes.last_modified_at
2025-03-23 08:12:17,145 - sqlalchemy.engine.Engine - INFO - [generated in 0.00190s] {'id': UUID('943fb914-e8d7-4313-9e2c-de924fb5f308'), 'level_id': UUID('00000000-0000-0000-0000-000000000000'), 'code': 'A', 'supervisor_id': None, 'student_rep_id': None, 'assistant_rep_id': None, 'order': 1, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:12:17,151 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:12:17,153 - kademia - ERROR - Unhandled exception | 739ad5a6-ec3b-4647-9a20-cfd4c3498c87 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000000 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "classes" violates foreign key constraint "fk_classes_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000000) is not present in table "academic_levels".

[SQL: INSERT INTO classes (id, level_id, code, supervisor_id, student_rep_id, assistant_rep_id, "order", created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(level_id)s::UUID, %(code)s, %(supervisor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(order)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING classes.created_at, classes.last_modified_at]
[parameters: {'id': UUID('943fb914-e8d7-4313-9e2c-de924fb5f308'), 'level_id': UUID('00000000-0000-0000-0000-000000000000'), 'code': 'A', 'supervisor_id': None, 'student_rep_id': None, 'assistant_rep_id': None, 'order': 1, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\classes.py", line 19, in create_class
    return class_crud.create_class(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\classes.py", line 30, in create_class
    new_class = self.factory.create_class(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\classes.py", line 74, in create_class
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.student_organisation_errors.RelatedLevelNotFoundError: Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000000 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "classes" violates foreign key constraint "fk_classes_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000000) is not present in table "academic_levels".

[SQL: INSERT INTO classes (id, level_id, code, supervisor_id, student_rep_id, assistant_rep_id, "order", created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(level_id)s::UUID, %(code)s, %(supervisor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(order)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING classes.created_at, classes.last_modified_at]
[parameters: {'id': UUID('943fb914-e8d7-4313-9e2c-de924fb5f308'), 'level_id': UUID('00000000-0000-0000-0000-000000000000'), 'code': 'A', 'supervisor_id': None, 'student_rep_id': None, 'assistant_rep_id': None, 'order': 1, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:12:17,167 - kademia - WARNING - RelationshipError | 739ad5a6-ec3b-4647-9a20-cfd4c3498c87 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000000 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "classes" violates foreign key constraint "fk_classes_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000000) is not present in table "academic_levels".

[SQL: INSERT INTO classes (id, level_id, code, supervisor_id, student_rep_id, assistant_rep_id, "order", created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(level_id)s::UUID, %(code)s, %(supervisor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(order)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING classes.created_at, classes.last_modified_at]
[parameters: {'id': UUID('943fb914-e8d7-4313-9e2c-de924fb5f308'), 'level_id': UUID('00000000-0000-0000-0000-000000000000'), 'code': 'A', 'supervisor_id': None, 'student_rep_id': None, 'assistant_rep_id': None, 'order': 1, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:12:34,856 - kademia - INFO - Request started | edca0073-7af9-4e05-a8ad-6164ba09df50 | POST /api/v1/admin/students/student_organization/
2025-03-23 08:12:34,860 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:12:34,862 - sqlalchemy.engine.Engine - INFO - SELECT max(classes."order") AS max_1 
FROM classes 
WHERE classes.level_id = %(level_id_1)s::UUID
2025-03-23 08:12:34,862 - sqlalchemy.engine.Engine - INFO - [cached since 17.73s ago] {'level_id_1': UUID('56b3bf97-4235-4c4c-949d-8ea8d83a2010')}
2025-03-23 08:12:34,865 - sqlalchemy.engine.Engine - INFO - INSERT INTO classes (id, level_id, code, supervisor_id, student_rep_id, assistant_rep_id, "order", created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(level_id)s::UUID, %(code)s, %(supervisor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(order)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING classes.created_at, classes.last_modified_at
2025-03-23 08:12:34,866 - sqlalchemy.engine.Engine - INFO - [cached since 17.72s ago] {'id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'level_id': UUID('56b3bf97-4235-4c4c-949d-8ea8d83a2010'), 'code': 'A', 'supervisor_id': None, 'student_rep_id': None, 'assistant_rep_id': None, 'order': 1, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:12:34,868 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:12:34,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:12:34,877 - sqlalchemy.engine.Engine - INFO - SELECT classes.id, classes.level_id, classes.code, classes.supervisor_id, classes.student_rep_id, classes.assistant_rep_id, classes."order", classes.created_by, classes.last_modified_by, classes.created_at, classes.last_modified_at, classes.is_archived, classes.archived_at, classes.archive_reason, classes.archived_by 
FROM classes 
WHERE classes.id = %(pk_1)s::UUID
2025-03-23 08:12:34,879 - sqlalchemy.engine.Engine - INFO - [generated in 0.00096s] {'pk_1': UUID('b647f782-6fc7-4151-958f-1e70c44431ff')}
2025-03-23 08:12:34,886 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:12:34,887 - kademia - INFO - Request completed | edca0073-7af9-4e05-a8ad-6164ba09df50 | Status: 201 | Time: 0.030s
2025-03-23 08:14:08,724 - kademia - INFO - Request started | 65176890-c96a-49ae-a520-c9d48e35534b | POST /api/v1/admin/students/
2025-03-23 08:14:08,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:14:08,997 - sqlalchemy.engine.Engine - INFO - SELECT max(CAST(SUBSTRING(students.student_id FROM %(substring_1)s) AS INTEGER)) AS max_1 
FROM students 
WHERE students.student_id LIKE %(student_id_1)s AND students.session_start_year = %(session_start_year_1)s
2025-03-23 08:14:08,998 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] {'substring_1': 8, 'student_id_1': 'SCH-25-%', 'session_start_year_1': 2025}
2025-03-23 08:14:09,012 - sqlalchemy.engine.Engine - INFO - INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at
2025-03-23 08:14:09,012 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('26409ad8-101e-4622-8eb8-1a3943a61da1'), 'password_hash': '$2b$12$3kfmXl1M7oUzXT1WSmSVTuY4K4l3mjM2gBlcqBhhJM.ZWhh1TXZFy', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:14:09,021 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:14:09,022 - kademia - ERROR - Unhandled exception | 65176890-c96a-49ae-a520-c9d48e35534b | Error during during fk insertion of department with id:00000000-0000-0000-0000-000000000003 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_student_departments_department_id"
DETAIL:  Key (department_id)=(00000000-0000-0000-0000-000000000003) is not present in table "student_departments".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('26409ad8-101e-4622-8eb8-1a3943a61da1'), 'password_hash': '$2b$12$3kfmXl1M7oUzXT1WSmSVTuY4K4l3mjM2gBlcqBhhJM.ZWhh1TXZFy', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\users\student\student.py", line 18, in create_student
    return student_crud.create_student(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\users\student.py", line 30, in create_student
    student = self.factory.create_student(data)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\users\student.py", line 81, in create_student
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.student_organisation_errors.RelatedStudentDepartmentNotFoundError: Error during during fk insertion of department with id:00000000-0000-0000-0000-000000000003 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_student_departments_department_id"
DETAIL:  Key (department_id)=(00000000-0000-0000-0000-000000000003) is not present in table "student_departments".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('26409ad8-101e-4622-8eb8-1a3943a61da1'), 'password_hash': '$2b$12$3kfmXl1M7oUzXT1WSmSVTuY4K4l3mjM2gBlcqBhhJM.ZWhh1TXZFy', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:14:09,030 - kademia - WARNING - RelationshipError | 65176890-c96a-49ae-a520-c9d48e35534b | Error during during fk insertion of department with id:00000000-0000-0000-0000-000000000003 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_student_departments_department_id"
DETAIL:  Key (department_id)=(00000000-0000-0000-0000-000000000003) is not present in table "student_departments".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('00000000-0000-0000-0000-000000000003'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('26409ad8-101e-4622-8eb8-1a3943a61da1'), 'password_hash': '$2b$12$3kfmXl1M7oUzXT1WSmSVTuY4K4l3mjM2gBlcqBhhJM.ZWhh1TXZFy', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:14:22,048 - kademia - INFO - Request started | 63a9e245-101d-4f78-9dbf-dd2b9d49c59f | POST /api/v1/admin/students/
2025-03-23 08:14:22,054 - kademia - INFO - Request completed | 63a9e245-101d-4f78-9dbf-dd2b9d49c59f | Status: 422 | Time: 0.005s
2025-03-23 08:14:46,467 - kademia - INFO - Request started | 6077658e-8de9-4806-8eea-410d3ffc0d0d | POST /api/v1/admin/students/
2025-03-23 08:14:46,717 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:14:46,718 - sqlalchemy.engine.Engine - INFO - SELECT max(CAST(SUBSTRING(students.student_id FROM %(substring_1)s) AS INTEGER)) AS max_1 
FROM students 
WHERE students.student_id LIKE %(student_id_1)s AND students.session_start_year = %(session_start_year_1)s
2025-03-23 08:14:46,719 - sqlalchemy.engine.Engine - INFO - [cached since 37.72s ago] {'substring_1': 8, 'student_id_1': 'SCH-25-%', 'session_start_year_1': 2025}
2025-03-23 08:14:46,721 - sqlalchemy.engine.Engine - INFO - INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at
2025-03-23 08:14:46,722 - sqlalchemy.engine.Engine - INFO - [cached since 37.71s ago] {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('c7f398d9-1b07-455f-bcbc-0ec376e7ead0'), 'password_hash': '$2b$12$L7AE/kBwOldM6PV3EGiukOig2h//U/HEdRiSsQbjtH05CPKUtiXGq', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:14:46,730 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:14:46,732 - kademia - ERROR - Unhandled exception | 6077658e-8de9-4806-8eea-410d3ffc0d0d | Error during during fk insertion of guardian with id:00000000-0000-0000-0000-000000000004 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_guardians_guardian_id"
DETAIL:  Key (guardian_id)=(00000000-0000-0000-0000-000000000004) is not present in table "guardians".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('c7f398d9-1b07-455f-bcbc-0ec376e7ead0'), 'password_hash': '$2b$12$L7AE/kBwOldM6PV3EGiukOig2h//U/HEdRiSsQbjtH05CPKUtiXGq', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\users\student\student.py", line 18, in create_student
    return student_crud.create_student(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\users\student.py", line 30, in create_student
    student = self.factory.create_student(data)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\users\student.py", line 81, in create_student
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.user_profile_errors.RelatedGuardianNotFoundError: Error during during fk insertion of guardian with id:00000000-0000-0000-0000-000000000004 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_guardians_guardian_id"
DETAIL:  Key (guardian_id)=(00000000-0000-0000-0000-000000000004) is not present in table "guardians".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('c7f398d9-1b07-455f-bcbc-0ec376e7ead0'), 'password_hash': '$2b$12$L7AE/kBwOldM6PV3EGiukOig2h//U/HEdRiSsQbjtH05CPKUtiXGq', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:14:46,741 - kademia - WARNING - RelationshipError | 6077658e-8de9-4806-8eea-410d3ffc0d0d | Error during during fk insertion of guardian with id:00000000-0000-0000-0000-000000000004 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_guardians_guardian_id"
DETAIL:  Key (guardian_id)=(00000000-0000-0000-0000-000000000004) is not present in table "guardians".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('00000000-0000-0000-0000-000000000004'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('c7f398d9-1b07-455f-bcbc-0ec376e7ead0'), 'password_hash': '$2b$12$L7AE/kBwOldM6PV3EGiukOig2h//U/HEdRiSsQbjtH05CPKUtiXGq', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:14:59,977 - kademia - INFO - Request started | 29c5c542-969a-432b-ab3b-2d573b1f1028 | POST /api/v1/admin/students/
2025-03-23 08:15:00,231 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:15:00,232 - sqlalchemy.engine.Engine - INFO - SELECT max(CAST(SUBSTRING(students.student_id FROM %(substring_1)s) AS INTEGER)) AS max_1 
FROM students 
WHERE students.student_id LIKE %(student_id_1)s AND students.session_start_year = %(session_start_year_1)s
2025-03-23 08:15:00,232 - sqlalchemy.engine.Engine - INFO - [cached since 51.24s ago] {'substring_1': 8, 'student_id_1': 'SCH-25-%', 'session_start_year_1': 2025}
2025-03-23 08:15:00,234 - sqlalchemy.engine.Engine - INFO - INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at
2025-03-23 08:15:00,235 - sqlalchemy.engine.Engine - INFO - [cached since 51.22s ago] {'student_id': 'SCH-25-00001', 'guardian_id': UUID('c6395ac5-00a3-49e4-8099-9623c02a84a7'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('42c3be7b-4fa4-4309-9068-c7b0bcbd1dbe'), 'password_hash': '$2b$12$69emxDF59bAayFbfwT3mPuoGnJ3akRG3y56YGl8Q/L59krCzzBncG', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:15:00,237 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:15:00,239 - kademia - ERROR - Unhandled exception | 29c5c542-969a-432b-ab3b-2d573b1f1028 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('c6395ac5-00a3-49e4-8099-9623c02a84a7'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('42c3be7b-4fa4-4309-9068-c7b0bcbd1dbe'), 'password_hash': '$2b$12$69emxDF59bAayFbfwT3mPuoGnJ3akRG3y56YGl8Q/L59krCzzBncG', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\users\student\student.py", line 18, in create_student
    return student_crud.create_student(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\users\student.py", line 30, in create_student
    student = self.factory.create_student(data)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\users\student.py", line 81, in create_student
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.student_organisation_errors.RelatedLevelNotFoundError: Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('c6395ac5-00a3-49e4-8099-9623c02a84a7'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('42c3be7b-4fa4-4309-9068-c7b0bcbd1dbe'), 'password_hash': '$2b$12$69emxDF59bAayFbfwT3mPuoGnJ3akRG3y56YGl8Q/L59krCzzBncG', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:15:00,244 - kademia - WARNING - RelationshipError | 29c5c542-969a-432b-ab3b-2d573b1f1028 | Error during during fk insertion of Academic Level with id:00000000-0000-0000-0000-000000000002 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "students" violates foreign key constraint "fk_students_academic_levels_level_id"
DETAIL:  Key (level_id)=(00000000-0000-0000-0000-000000000002) is not present in table "academic_levels".

[SQL: INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at]
[parameters: {'student_id': 'SCH-25-00001', 'guardian_id': UUID('c6395ac5-00a3-49e4-8099-9623c02a84a7'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('00000000-0000-0000-0000-000000000002'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('42c3be7b-4fa4-4309-9068-c7b0bcbd1dbe'), 'password_hash': '$2b$12$69emxDF59bAayFbfwT3mPuoGnJ3akRG3y56YGl8Q/L59krCzzBncG', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:15:32,111 - kademia - INFO - Request started | 5e5f96b8-c6eb-47c0-9033-9c0c62abccda | POST /api/v1/admin/students/
2025-03-23 08:15:32,363 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:15:32,364 - sqlalchemy.engine.Engine - INFO - SELECT max(CAST(SUBSTRING(students.student_id FROM %(substring_1)s) AS INTEGER)) AS max_1 
FROM students 
WHERE students.student_id LIKE %(student_id_1)s AND students.session_start_year = %(session_start_year_1)s
2025-03-23 08:15:32,364 - sqlalchemy.engine.Engine - INFO - [cached since 83.37s ago] {'substring_1': 8, 'student_id_1': 'SCH-25-%', 'session_start_year_1': 2025}
2025-03-23 08:15:32,367 - sqlalchemy.engine.Engine - INFO - INSERT INTO students (student_id, guardian_id, user_type, access_level, status, date_of_birth, image_url, level_id, class_id, department_id, is_repeating, session_start_year, date_left, graduation_date, id, password_hash, first_name, last_name, gender, last_login, deletion_eligible, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(student_id)s, %(guardian_id)s::UUID, %(user_type)s, %(access_level)s, %(status)s, %(date_of_birth)s, %(image_url)s, %(level_id)s::UUID, %(class_id)s::UUID, %(department_id)s::UUID, %(is_repeating)s, %(session_start_year)s, %(date_left)s, %(graduation_date)s, %(id)s::UUID, %(password_hash)s, %(first_name)s, %(last_name)s, %(gender)s, %(last_login)s, %(deletion_eligible)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING students.created_at, students.last_modified_at
2025-03-23 08:15:32,367 - sqlalchemy.engine.Engine - INFO - [cached since 83.36s ago] {'student_id': 'SCH-25-00001', 'guardian_id': UUID('c6395ac5-00a3-49e4-8099-9623c02a84a7'), 'user_type': 'STUDENT', 'access_level': 'READ', 'status': 'ENROLLED', 'date_of_birth': datetime.date(2010, 5, 15), 'image_url': None, 'level_id': UUID('56b3bf97-4235-4c4c-949d-8ea8d83a2010'), 'class_id': UUID('b647f782-6fc7-4151-958f-1e70c44431ff'), 'department_id': UUID('eed42413-ea88-47a7-b6fa-06c128e29640'), 'is_repeating': False, 'session_start_year': 2025, 'date_left': None, 'graduation_date': None, 'id': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff'), 'password_hash': '$2b$12$D0LVCVoW.sOsHvMtnsvB9e8uF5WtgobltTBinIPO2JA.n.3KdDMv.', 'first_name': 'Omotara', 'last_name': 'Johnson', 'gender': 'FEMALE', 'last_login': None, 'deletion_eligible': False, 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:15:32,370 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:15:32,374 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:15:32,377 - sqlalchemy.engine.Engine - INFO - SELECT students.student_id, students.guardian_id, students.user_type, students.access_level, students.status, students.date_of_birth, students.image_url, students.level_id, students.class_id, students.department_id, students.is_repeating, students.session_start_year, students.date_left, students.graduation_date, students.id, students.password_hash, students.first_name, students.last_name, students.gender, students.last_login, students.deletion_eligible, students.created_by, students.last_modified_by, students.created_at, students.last_modified_at, students.is_archived, students.archived_at, students.archive_reason, students.archived_by 
FROM students 
WHERE students.id = %(pk_1)s::UUID
2025-03-23 08:15:32,377 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] {'pk_1': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff')}
2025-03-23 08:15:32,380 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:15:32,381 - kademia - INFO - Request completed | 5e5f96b8-c6eb-47c0-9033-9c0c62abccda | Status: 201 | Time: 0.269s
2025-03-23 08:16:47,779 - kademia - INFO - Request started | 426d6803-1482-43f4-805c-d91bf0a5d9b1 | GET /api/v1/admin/students/
2025-03-23 08:16:47,781 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:16:47,785 - sqlalchemy.engine.Engine - INFO - SELECT students.student_id AS students_student_id, students.guardian_id AS students_guardian_id, students.user_type AS students_user_type, students.access_level AS students_access_level, students.status AS students_status, students.date_of_birth AS students_date_of_birth, students.image_url AS students_image_url, students.level_id AS students_level_id, students.class_id AS students_class_id, students.department_id AS students_department_id, students.is_repeating AS students_is_repeating, students.session_start_year AS students_session_start_year, students.date_left AS students_date_left, students.graduation_date AS students_graduation_date, students.id AS students_id, students.password_hash AS students_password_hash, students.first_name AS students_first_name, students.last_name AS students_last_name, students.gender AS students_gender, students.last_login AS students_last_login, students.deletion_eligible AS students_deletion_eligible, students.created_by AS students_created_by, students.last_modified_by AS students_last_modified_by, students.created_at AS students_created_at, students.last_modified_at AS students_last_modified_at, students.is_archived AS students_is_archived, students.archived_at AS students_archived_at, students.archive_reason AS students_archive_reason, students.archived_by AS students_archived_by 
FROM students 
WHERE students.is_archived = false ORDER BY students.last_name DESC 
 LIMIT %(param_1)s OFFSET %(param_2)s
2025-03-23 08:16:47,786 - sqlalchemy.engine.Engine - INFO - [generated in 0.00127s] {'param_1': 50, 'param_2': 0}
2025-03-23 08:16:47,789 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:16:47,790 - kademia - INFO - Request completed | 426d6803-1482-43f4-805c-d91bf0a5d9b1 | Status: 200 | Time: 0.011s
2025-03-23 08:16:58,139 - kademia - INFO - Request started | e4fc99e0-e1c2-445c-b95f-db35b4d85cdc | GET /api/v1/admin/archive/students/
2025-03-23 08:16:58,141 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:16:58,144 - sqlalchemy.engine.Engine - INFO - SELECT students.student_id AS students_student_id, students.guardian_id AS students_guardian_id, students.user_type AS students_user_type, students.access_level AS students_access_level, students.status AS students_status, students.date_of_birth AS students_date_of_birth, students.image_url AS students_image_url, students.level_id AS students_level_id, students.class_id AS students_class_id, students.department_id AS students_department_id, students.is_repeating AS students_is_repeating, students.session_start_year AS students_session_start_year, students.date_left AS students_date_left, students.graduation_date AS students_graduation_date, students.id AS students_id, students.password_hash AS students_password_hash, students.first_name AS students_first_name, students.last_name AS students_last_name, students.gender AS students_gender, students.last_login AS students_last_login, students.deletion_eligible AS students_deletion_eligible, students.created_by AS students_created_by, students.last_modified_by AS students_last_modified_by, students.created_at AS students_created_at, students.last_modified_at AS students_last_modified_at, students.is_archived AS students_is_archived, students.archived_at AS students_archived_at, students.archive_reason AS students_archive_reason, students.archived_by AS students_archived_by 
FROM students 
WHERE students.is_archived = true ORDER BY students.last_name DESC 
 LIMIT %(param_1)s OFFSET %(param_2)s
2025-03-23 08:16:58,145 - sqlalchemy.engine.Engine - INFO - [generated in 0.00135s] {'param_1': 50, 'param_2': 0}
2025-03-23 08:16:58,150 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:16:58,165 - kademia - INFO - Request completed | e4fc99e0-e1c2-445c-b95f-db35b4d85cdc | Status: 200 | Time: 0.026s
2025-03-23 08:20:24,287 - kademia - INFO - Request started | ebfd620c-af94-4f50-9a84-afa66be34e79 | POST /api/v1/admin/staff/qualifications/
2025-03-23 08:20:24,292 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:20:24,295 - sqlalchemy.engine.Engine - INFO - INSERT INTO educator_qualifications (id, educator_id, name, description, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(educator_id)s::UUID, %(name)s, %(description)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING educator_qualifications.created_at, educator_qualifications.last_modified_at
2025-03-23 08:20:24,296 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] {'id': UUID('74e6968a-3135-48f4-868e-46c4131f0ecd'), 'educator_id': UUID('00000000-0000-0000-0000-000000000001'), 'name': 'Master Of Science In Mathematics', 'description': 'Advanced Degree In Pure Mathematics', 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:20:24,302 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:20:24,304 - kademia - ERROR - Unhandled exception | ebfd620c-af94-4f50-9a84-afa66be34e79 | Error during during fk insertion of Educator with id:00000000-0000-0000-0000-000000000001 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "educator_qualifications" violates foreign key constraint "fk_educator_qualifications_educators_educator_id"
DETAIL:  Key (educator_id)=(00000000-0000-0000-0000-000000000001) is not present in table "educators".

[SQL: INSERT INTO educator_qualifications (id, educator_id, name, description, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(educator_id)s::UUID, %(name)s, %(description)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING educator_qualifications.created_at, educator_qualifications.last_modified_at]
[parameters: {'id': UUID('74e6968a-3135-48f4-868e-46c4131f0ecd'), 'educator_id': UUID('00000000-0000-0000-0000-000000000001'), 'name': 'Master Of Science In Mathematics', 'description': 'Advanced Degree In Pure Mathematics', 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\staff_organization\qualifications.py", line 20, in create_qualification
    return qualifications_crud.create_qualification(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\staff_organization\educator_qualification.py", line 30, in create_qualification
    qualification = self.factory.create_qualification(data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\staff_organization\qualification.py", line 59, in create_qualification
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.user_profile_errors.RelatedEducatorNotFoundError: Error during during fk insertion of Educator with id:00000000-0000-0000-0000-000000000001 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "educator_qualifications" violates foreign key constraint "fk_educator_qualifications_educators_educator_id"
DETAIL:  Key (educator_id)=(00000000-0000-0000-0000-000000000001) is not present in table "educators".

[SQL: INSERT INTO educator_qualifications (id, educator_id, name, description, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(educator_id)s::UUID, %(name)s, %(description)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING educator_qualifications.created_at, educator_qualifications.last_modified_at]
[parameters: {'id': UUID('74e6968a-3135-48f4-868e-46c4131f0ecd'), 'educator_id': UUID('00000000-0000-0000-0000-000000000001'), 'name': 'Master Of Science In Mathematics', 'description': 'Advanced Degree In Pure Mathematics', 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:20:24,316 - kademia - WARNING - RelationshipError | ebfd620c-af94-4f50-9a84-afa66be34e79 | Error during during fk insertion of Educator with id:00000000-0000-0000-0000-000000000001 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "educator_qualifications" violates foreign key constraint "fk_educator_qualifications_educators_educator_id"
DETAIL:  Key (educator_id)=(00000000-0000-0000-0000-000000000001) is not present in table "educators".

[SQL: INSERT INTO educator_qualifications (id, educator_id, name, description, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(educator_id)s::UUID, %(name)s, %(description)s, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING educator_qualifications.created_at, educator_qualifications.last_modified_at]
[parameters: {'id': UUID('74e6968a-3135-48f4-868e-46c4131f0ecd'), 'educator_id': UUID('00000000-0000-0000-0000-000000000001'), 'name': 'Master Of Science In Mathematics', 'description': 'Advanced Degree In Pure Mathematics', 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:20:44,186 - kademia - INFO - Request started | 1e4aae22-9f18-4065-827d-ccef1176fc66 | POST /api/v1/admin/staff/departments/
2025-03-23 08:20:44,189 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:20:44,193 - sqlalchemy.engine.Engine - INFO - INSERT INTO staff_departments (id, name, description, manager_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(description)s, %(manager_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING staff_departments.created_at, staff_departments.last_modified_at
2025-03-23 08:20:44,193 - sqlalchemy.engine.Engine - INFO - [generated in 0.00092s] {'id': UUID('7ee56d1c-8093-4672-bd6f-b5e54b19a73c'), 'name': 'Academic Affairs', 'description': 'Manages Academic Programs And Curriculum', 'manager_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:20:44,213 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:20:44,218 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:20:44,222 - sqlalchemy.engine.Engine - INFO - SELECT staff_departments.id, staff_departments.name, staff_departments.description, staff_departments.manager_id, staff_departments.created_by, staff_departments.last_modified_by, staff_departments.created_at, staff_departments.last_modified_at, staff_departments.is_archived, staff_departments.archived_at, staff_departments.archive_reason, staff_departments.archived_by 
FROM staff_departments 
WHERE staff_departments.id = %(pk_1)s::UUID
2025-03-23 08:20:44,223 - sqlalchemy.engine.Engine - INFO - [generated in 0.00092s] {'pk_1': UUID('7ee56d1c-8093-4672-bd6f-b5e54b19a73c')}
2025-03-23 08:20:44,230 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:20:44,230 - kademia - INFO - Request completed | 1e4aae22-9f18-4065-827d-ccef1176fc66 | Status: 201 | Time: 0.043s
2025-03-23 08:23:00,961 - kademia - INFO - Application started
2025-03-23 08:23:05,465 - kademia - INFO - Request started | a14dc66b-8b9b-4e0f-a6d1-093aa8a11ba4 | GET /docs
2025-03-23 08:23:05,467 - kademia - INFO - Request completed | a14dc66b-8b9b-4e0f-a6d1-093aa8a11ba4 | Status: 200 | Time: 0.001s
2025-03-23 08:23:05,595 - kademia - INFO - Request started | e0b7ed8b-0ede-4555-84b0-9bb0f5d8406f | GET /openapi.json
2025-03-23 08:23:05,746 - kademia - INFO - Request completed | e0b7ed8b-0ede-4555-84b0-9bb0f5d8406f | Status: 200 | Time: 0.152s
2025-03-23 08:23:25,257 - kademia - INFO - Request started | bace7213-4090-45a6-83bc-0213247fc751 | POST /api/v1/admin/students/departments/
2025-03-23 08:23:25,601 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 08:23:25,601 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:23:25,602 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 08:23:25,604 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:23:25,606 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 08:23:25,607 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:23:25,608 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:23:25,612 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:23:25,612 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] {'id': UUID('6d3871a5-2509-43ca-981e-efe6c7aff424'), 'name': 'Science', 'code': 'SCI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:23:25,616 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:23:25,617 - kademia - ERROR - Unhandled exception | bace7213-4090-45a6-83bc-0213247fc751 | Duplicate student department creation attempted: Unique constraint violation - Detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_name_key"
detail:  key (name)=(science) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('6d3871a5-2509-43ca-981e-efe6c7aff424'), 'name': 'science', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 46, in create_student_department
    raise DuplicateStudentDepartmentError(
app.core.errors.student_organisation_errors.DuplicateStudentDepartmentError: Duplicate student department creation attempted: Unique constraint violation - Detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_name_key"
detail:  key (name)=(science) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('6d3871a5-2509-43ca-981e-efe6c7aff424'), 'name': 'science', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:23:25,631 - kademia - WARNING - UniqueViolationError | bace7213-4090-45a6-83bc-0213247fc751 | Duplicate student department creation attempted: Unique constraint violation - Detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_name_key"
detail:  key (name)=(science) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('6d3871a5-2509-43ca-981e-efe6c7aff424'), 'name': 'science', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:23:34,267 - kademia - INFO - Request started | b09e13aa-3b04-4a5e-ba60-e0dd37c307ef | POST /api/v1/admin/students/departments/
2025-03-23 08:23:34,271 - kademia - ERROR - Unhandled exception | b09e13aa-3b04-4a5e-ba60-e0dd37c307ef | 
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 33, in create_student_department
    name = self.validator.validate_name(new_department.name),
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\validators\student_organization.py", line 18, in validate_name
    raise InvalidCharacterError(entry=value, domain=self.domain)
app.core.errors.input_validation_errors.InvalidCharacterError
2025-03-23 08:23:34,275 - kademia - WARNING - InvalidCharacterError | b09e13aa-3b04-4a5e-ba60-e0dd37c307ef | Domain: STUDENT ORGANIZATION-- Input attempted with invalid character: Scien666e
2025-03-23 08:23:42,574 - kademia - INFO - Request started | 3258fbb2-83c9-421d-b4c6-2b381444b89b | POST /api/v1/admin/students/departments/
2025-03-23 08:23:42,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:23:42,577 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:23:42,577 - sqlalchemy.engine.Engine - INFO - [cached since 16.97s ago] {'id': UUID('d7cb80b0-6f46-435f-885b-a81f693229ae'), 'name': 'Scienyrye', 'code': 'SCI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:23:42,579 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:23:42,581 - kademia - ERROR - Unhandled exception | 3258fbb2-83c9-421d-b4c6-2b381444b89b | Duplicate student department creation attempted: unique constraint violation - detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_code_key"
detail:  key (code)=(sci) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('d7cb80b0-6f46-435f-885b-a81f693229ae'), 'name': 'scienyrye', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 50, in create_student_department
    raise DuplicateStudentDepartmentError(
app.core.errors.student_organisation_errors.DuplicateStudentDepartmentError: Duplicate student department creation attempted: unique constraint violation - detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_code_key"
detail:  key (code)=(sci) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('d7cb80b0-6f46-435f-885b-a81f693229ae'), 'name': 'scienyrye', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:23:42,588 - kademia - WARNING - UniqueViolationError | 3258fbb2-83c9-421d-b4c6-2b381444b89b | Duplicate student department creation attempted: unique constraint violation - detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_code_key"
detail:  key (code)=(sci) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('d7cb80b0-6f46-435f-885b-a81f693229ae'), 'name': 'scienyrye', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:25:30,173 - kademia - INFO - Application started
2025-03-23 08:25:35,261 - kademia - INFO - Request started | b1d3b49a-fa1c-41a6-bd31-0a9f5eff2c65 | POST /api/v1/admin/students/departments/
2025-03-23 08:25:35,268 - kademia - ERROR - Unhandled exception | b1d3b49a-fa1c-41a6-bd31-0a9f5eff2c65 | 
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 34, in create_student_department
    code=self.validator.validate_code(new_department.code),
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\validators\student_organization.py", line 49, in validate_code
    raise InvalidCodeError(entry = value, length=3, domain = self.domain)
app.core.errors.input_validation_errors.InvalidCodeError
2025-03-23 08:25:35,290 - kademia - WARNING - InvalidCodeError | b1d3b49a-fa1c-41a6-bd31-0a9f5eff2c65 | Domain: STUDENT ORGANIZATION-- Input attempted with Invalid length: SaCI
2025-03-23 08:25:46,221 - kademia - INFO - Request started | 85246910-f116-4d6a-a183-12671c3f7f97 | POST /api/v1/admin/students/departments/
2025-03-23 08:25:46,464 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 08:25:46,465 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:25:46,467 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 08:25:46,467 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:25:46,468 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 08:25:46,469 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:25:46,470 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:25:46,472 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:25:46,473 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] {'id': UUID('f72acbff-737d-4cff-83c3-db329cde019a'), 'name': 'Scienyrye', 'code': 'SCW', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:25:46,486 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:25:46,487 - kademia - ERROR - Unhandled exception | 85246910-f116-4d6a-a183-12671c3f7f97 | Foreign key constraint violation during create operation. Detail: Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('f72acbff-737d-4cff-83c3-db329cde019a'), 'name': 'Scienyrye', 'code': 'SCW', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 69, in create_student_department
    raise RelationshipError(error=error_message, operation='create', entity='unknown_entity')
app.core.errors.database_errors.RelationshipError: Foreign key constraint violation during create operation. Detail: Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('f72acbff-737d-4cff-83c3-db329cde019a'), 'name': 'Scienyrye', 'code': 'SCW', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:25:46,492 - kademia - WARNING - RelationshipError | 85246910-f116-4d6a-a183-12671c3f7f97 | Foreign key constraint violation during create operation. Detail: Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('f72acbff-737d-4cff-83c3-db329cde019a'), 'name': 'Scienyrye', 'code': 'SCW', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:26:44,541 - kademia - INFO - Application started
2025-03-23 08:26:46,851 - kademia - INFO - Request started | fa28f76e-67b4-467b-bcf5-d805f165f9fe | GET /docs
2025-03-23 08:26:46,855 - kademia - INFO - Request completed | fa28f76e-67b4-467b-bcf5-d805f165f9fe | Status: 200 | Time: 0.002s
2025-03-23 08:26:46,991 - kademia - INFO - Request started | 97c3e984-8f7c-4757-af5c-d38ff00b6eed | GET /openapi.json
2025-03-23 08:26:47,109 - kademia - INFO - Request completed | 97c3e984-8f7c-4757-af5c-d38ff00b6eed | Status: 200 | Time: 0.118s
2025-03-23 08:27:06,140 - kademia - INFO - Request started | 7e0e63fa-554e-4ddc-9b52-a68554ca43c7 | POST /api/v1/admin/students/departments/
2025-03-23 08:27:06,446 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-03-23 08:27:06,446 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:27:06,447 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-03-23 08:27:06,447 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:27:06,448 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-03-23 08:27:06,448 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-03-23 08:27:06,449 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:27:06,454 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:27:06,455 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] {'id': UUID('53eed9c9-441e-4443-8b72-3ba44ea45c99'), 'name': 'Science', 'code': 'SCI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:27:06,458 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:27:06,460 - kademia - ERROR - Unhandled exception | 7e0e63fa-554e-4ddc-9b52-a68554ca43c7 | Duplicate student department creation attempted: Unique constraint violation - Detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_name_key"
detail:  key (name)=(science) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('53eed9c9-441e-4443-8b72-3ba44ea45c99'), 'name': 'science', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 46, in create_student_department
    raise DuplicateStudentDepartmentError(
app.core.errors.student_organisation_errors.DuplicateStudentDepartmentError: Duplicate student department creation attempted: Unique constraint violation - Detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_name_key"
detail:  key (name)=(science) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('53eed9c9-441e-4443-8b72-3ba44ea45c99'), 'name': 'science', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:27:06,474 - kademia - WARNING - UniqueViolationError | 7e0e63fa-554e-4ddc-9b52-a68554ca43c7 | Duplicate student department creation attempted: Unique constraint violation - Detail: (psycopg2.errors.uniqueviolation) duplicate key value violates unique constraint "student_departments_name_key"
detail:  key (name)=(science) already exists.

[sql: insert into student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) values (%(id)s::uuid, %(name)s, %(code)s, %(description)s, %(mentor_id)s::uuid, %(student_rep_id)s::uuid, %(assistant_rep_id)s::uuid, %(created_by)s::uuid, %(last_modified_by)s::uuid, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::uuid) returning student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': uuid('53eed9c9-441e-4443-8b72-3ba44ea45c99'), 'name': 'science', 'code': 'sci', 'description': 'science classes', 'mentor_id': none, 'student_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': uuid('00000000-0000-0000-0000-000000000099'), 'created_by': uuid('00000000-0000-0000-0000-000000000000'), 'last_modified_by': uuid('00000000-0000-0000-0000-000000000000'), 'is_archived': false, 'archived_at': none, 'archive_reason': none, 'archived_by': none}]
(background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:27:16,227 - kademia - INFO - Request started | 8a1a44a9-6b9c-4259-8535-4b38aa63f14f | POST /api/v1/admin/students/departments/
2025-03-23 08:27:16,231 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:27:16,231 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:27:16,232 - sqlalchemy.engine.Engine - INFO - [cached since 9.778s ago] {'id': UUID('acca6eb6-ba2d-4de7-8eae-79a9ec8fe462'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:27:16,249 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:27:16,255 - kademia - ERROR - Unhandled exception | 8a1a44a9-6b9c-4259-8535-4b38aa63f14f | Error during during fk insertion of student with id:00000000-0000-0000-0000-000000000099 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('acca6eb6-ba2d-4de7-8eae-79a9ec8fe462'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 68, in create_student_department
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.user_profile_errors.RelatedStudentNotFoundError: Error during during fk insertion of student with id:00000000-0000-0000-0000-000000000099 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('acca6eb6-ba2d-4de7-8eae-79a9ec8fe462'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:27:16,267 - kademia - WARNING - RelationshipError | 8a1a44a9-6b9c-4259-8535-4b38aa63f14f | Error during during fk insertion of student with id:00000000-0000-0000-0000-000000000099 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('acca6eb6-ba2d-4de7-8eae-79a9ec8fe462'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:27:37,926 - kademia - INFO - Request started | 7c58d11e-81f5-490b-8291-32950da6f3e0 | POST /api/v1/admin/students/departments/
2025-03-23 08:27:37,927 - kademia - INFO - Request completed | 7c58d11e-81f5-490b-8291-32950da6f3e0 | Status: 422 | Time: 0.002s
2025-03-23 08:27:49,122 - kademia - INFO - Request started | 51241ac1-0802-4f07-ba1a-900300a31a0e | POST /api/v1/admin/students/departments/
2025-03-23 08:27:49,124 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:27:49,126 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:27:49,126 - sqlalchemy.engine.Engine - INFO - [cached since 42.67s ago] {'id': UUID('dbeb84c3-d1f4-46e1-97a9-c35c6d6aeb39'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:27:49,127 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:27:49,129 - kademia - ERROR - Unhandled exception | 51241ac1-0802-4f07-ba1a-900300a31a0e | Error during during fk insertion of student with id:00000000-0000-0000-0000-000000000099 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('dbeb84c3-d1f4-46e1-97a9-c35c6d6aeb39'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 106, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 124, in receive
    return receiver.item
           ^^^^^^^^^^^^^
AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 157, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\middleware\error_handler.py", line 94, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\fastapi\routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\starlette\concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 2461, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 962, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\routers\student_organization\student_departments.py", line 22, in create_department
    return student_departments_crud.create_department(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\crud\student_organization\student_departments.py", line 30, in create_department
    department = self.factory.create_student_department(data)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dell\Desktop\Engineering\Projects\Kademia\V2\app\core\factories\student_organization\department.py", line 68, in create_student_department
    raise error_class(id=entity_id, detail=error_message, action='create')
app.core.errors.user_profile_errors.RelatedStudentNotFoundError: Error during during fk insertion of student with id:00000000-0000-0000-0000-000000000099 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('dbeb84c3-d1f4-46e1-97a9-c35c6d6aeb39'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:27:49,136 - kademia - WARNING - RelationshipError | 51241ac1-0802-4f07-ba1a-900300a31a0e | Error during during fk insertion of student with id:00000000-0000-0000-0000-000000000099 during create operation. Detail Foreign key constraint violation during create operation. Detail: (psycopg2.errors.ForeignKeyViolation) insert or update on table "student_departments" violates foreign key constraint "fk_student_departments_students_student_rep"
DETAIL:  Key (student_rep_id)=(00000000-0000-0000-0000-000000000099) is not present in table "students".

[SQL: INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at]
[parameters: {'id': UUID('dbeb84c3-d1f4-46e1-97a9-c35c6d6aeb39'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('00000000-0000-0000-0000-000000000099'), 'assistant_rep_id': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-03-23 08:28:02,699 - kademia - INFO - Request started | 558e8cba-9aa6-4161-ad2b-6ccb100e99f2 | POST /api/v1/admin/students/departments/
2025-03-23 08:28:02,701 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:28:02,703 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_departments (id, name, code, description, mentor_id, student_rep_id, assistant_rep_id, created_by, last_modified_by, created_at, last_modified_at, is_archived, archived_at, archive_reason, archived_by) VALUES (%(id)s::UUID, %(name)s, %(code)s, %(description)s, %(mentor_id)s::UUID, %(student_rep_id)s::UUID, %(assistant_rep_id)s::UUID, %(created_by)s::UUID, %(last_modified_by)s::UUID, now(), now(), %(is_archived)s, %(archived_at)s, %(archive_reason)s, %(archived_by)s::UUID) RETURNING student_departments.created_at, student_departments.last_modified_at
2025-03-23 08:28:02,703 - sqlalchemy.engine.Engine - INFO - [cached since 56.25s ago] {'id': UUID('20838256-9e0f-4da2-be87-eb9a2ea23422'), 'name': 'Scienwsce', 'code': 'SAI', 'description': 'Science Classes', 'mentor_id': None, 'student_rep_id': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff'), 'assistant_rep_id': UUID('9044876d-c2fd-4aa1-badd-8012e07b19ff'), 'created_by': UUID('00000000-0000-0000-0000-000000000000'), 'last_modified_by': UUID('00000000-0000-0000-0000-000000000000'), 'is_archived': False, 'archived_at': None, 'archive_reason': None, 'archived_by': None}
2025-03-23 08:28:02,706 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-03-23 08:28:02,712 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-03-23 08:28:02,720 - sqlalchemy.engine.Engine - INFO - SELECT student_departments.id, student_departments.name, student_departments.code, student_departments.description, student_departments.mentor_id, student_departments.student_rep_id, student_departments.assistant_rep_id, student_departments.created_by, student_departments.last_modified_by, student_departments.created_at, student_departments.last_modified_at, student_departments.is_archived, student_departments.archived_at, student_departments.archive_reason, student_departments.archived_by 
FROM student_departments 
WHERE student_departments.id = %(pk_1)s::UUID
2025-03-23 08:28:02,727 - sqlalchemy.engine.Engine - INFO - [generated in 0.00629s] {'pk_1': UUID('20838256-9e0f-4da2-be87-eb9a2ea23422')}
2025-03-23 08:28:02,739 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-03-23 08:28:02,740 - kademia - INFO - Request completed | 558e8cba-9aa6-4161-ad2b-6ccb100e99f2 | Status: 201 | Time: 0.040s
2025-03-23 08:41:52,334 - kademia - INFO - Application started
2025-03-23 08:42:08,399 - kademia - INFO - Application started
2025-03-23 08:48:52,794 - kademia - INFO - Application started
2025-03-23 08:49:21,911 - kademia - INFO - Application started
2025-03-23 08:49:47,341 - kademia - INFO - Application started
2025-03-23 10:33:57,191 - kademia - INFO - Application started
2025-03-23 23:23:35,625 - kademia - INFO - Application started
2025-03-23 23:23:37,827 - kademia - INFO - Request started | 367c941f-d5c9-4cf9-9422-0ff2fe6bcc3d | GET /
2025-03-23 23:23:37,830 - kademia - INFO - Request completed | 367c941f-d5c9-4cf9-9422-0ff2fe6bcc3d | Status: 200 | Time: 0.002s
